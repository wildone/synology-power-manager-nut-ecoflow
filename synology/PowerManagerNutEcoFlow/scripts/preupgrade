#!/bin/bash
# Pre-upgrade script backs up configuration files before upgrade.
set -euo pipefail

readonly PACKAGE_NAME="PowerManagerNutEcoFlow"
readonly TARGET_ROOT="/var/packages/${PACKAGE_NAME}/target"
readonly CONFIG_DIR="${TARGET_ROOT}/usr/local/bin/nas/x86_64-pc-linux-gnu-nut-server/etc"
readonly BACKUP_DIR="${TARGET_ROOT}/var/backup"

if [ "${SYNOPKG_PKG_STATUS}" = "UPGRADE" ]; then
    mkdir -p "${BACKUP_DIR}"
    for file in "ups.conf" "upsd.conf" "upsd.users" "upsmon.conf"; do
        if [ -f "${CONFIG_DIR}/${file}" ]; then
            cp "${CONFIG_DIR}/${file}" "${BACKUP_DIR}/${file}" || true
        fi
    done
fi

exit 0

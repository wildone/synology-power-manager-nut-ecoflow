#!/bin/bash
# Build stage script executed inside Synology toolkit environment.
set -euo pipefail

SCRIPT_PATH="${BASH_SOURCE[0]:-$0}"
SCRIPT_DIR="$(cd "$(dirname "${SCRIPT_PATH}")" && pwd -P)"
PROJECT_ROOT="$(cd "${SCRIPT_DIR}/.." && pwd -P)"
RUN_SCRIPT="${PROJECT_ROOT}/package/usr/local/bin/nas/run.sh"
SHUTDOWN_SCRIPT="${PROJECT_ROOT}/package/usr/local/bin/nas/x86_64-pc-linux-gnu-nut-server/script/eco_shutdown.sh"
SETUP_SCRIPT="${PROJECT_ROOT}/package/usr/local/bin/nas/x86_64-pc-linux-gnu-nut-server/script/setup_env.sh"

if [ -f "${RUN_SCRIPT}" ]; then
    chmod 755 "${RUN_SCRIPT}"
fi
if [ -f "${SHUTDOWN_SCRIPT}" ]; then
    chmod 755 "${SHUTDOWN_SCRIPT}"
fi
if [ -f "${SETUP_SCRIPT}" ]; then
    chmod 755 "${SETUP_SCRIPT}"
fi

PACKAGE_BIN_DIR="${PROJECT_ROOT}/package/usr/local/bin"
if [ -d "${PACKAGE_BIN_DIR}" ]; then
    find "${PACKAGE_BIN_DIR}" -type f -name "*.cgi" -exec chmod 755 {} +
fi

exit 0

